// DBML - Database Markup Language Examples
// Use at: https://dbdiagram.io

// ============================================
// SIMPLE E-COMMERCE EXAMPLE
// ============================================

Table customers {
  customer_id int [pk, increment]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  email varchar(100) [unique, not null]
  phone varchar(20)
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  
  Indexes {
    email [unique]
    (first_name, last_name)
  }
}

Table products {
  product_id int [pk, increment]
  product_name varchar(100) [not null]
  description text
  price decimal(10,2) [not null]
  stock_quantity int [default: 0]
  category_id int [ref: > categories.category_id]
  created_at timestamp [default: `CURRENT_TIMESTAMP`]
  
  Indexes {
    category_id
    price
  }
}

Table categories {
  category_id int [pk, increment]
  category_name varchar(50) [unique, not null]
  parent_category_id int [ref: > categories.category_id]
  description text
  
  Note: 'Self-referencing for category hierarchy'
}

Table orders {
  order_id int [pk, increment]
  customer_id int [not null, ref: > customers.customer_id]
  order_date date [not null]
  total_amount decimal(10,2)
  status varchar(20) [default: 'pending']
  shipping_address_id int [ref: > addresses.address_id]
  
  Indexes {
    customer_id
    order_date
    status
  }
}

Table order_items {
  order_item_id int [pk, increment]
  order_id int [not null, ref: > orders.order_id]
  product_id int [not null, ref: > products.product_id]
  quantity int [not null]
  unit_price decimal(10,2) [not null]
  
  Indexes {
    (order_id, product_id) [unique]
  }
}

Table addresses {
  address_id int [pk, increment]
  customer_id int [not null, ref: > customers.customer_id]
  street_address varchar(255)
  city varchar(100)
  state varchar(50)
  postal_code varchar(20)
  country varchar(50)
  is_default boolean [default: false]
}

Table reviews {
  review_id int [pk, increment]
  product_id int [not null, ref: > products.product_id]
  customer_id int [not null, ref: > customers.customer_id]
  rating int [not null, note: 'Between 1-5']
  comment text
  review_date timestamp [default: `CURRENT_TIMESTAMP`]
  
  Indexes {
    (product_id, customer_id) [unique]
    rating
  }
}

// ============================================
// ENUMS
// ============================================

enum order_status {
  pending
  processing
  shipped
  delivered
  cancelled
}

// ============================================
// NOTES AND RELATIONSHIPS
// ============================================

// One-to-Many: One customer can have many orders
Ref: customers.customer_id < orders.customer_id

// One-to-Many: One order can have many order items
Ref: orders.order_id < order_items.order_id

// Many-to-Many: Products and Orders (through order_items)
// Implicitly defined through order_items junction table

// ============================================
// LIBRARY SYSTEM EXAMPLE
// ============================================

Table books {
  book_id int [pk, increment]
  isbn varchar(13) [unique, not null]
  title varchar(200) [not null]
  publication_year int
  publisher_id int [ref: > publishers.publisher_id]
  available_copies int [default: 0]
  
  Note: 'Core book information'
}

Table authors {
  author_id int [pk, increment]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  birth_date date
  country varchar(50)
  
  Indexes {
    (first_name, last_name)
  }
}

Table book_authors {
  book_id int [ref: > books.book_id]
  author_id int [ref: > authors.author_id]
  author_order int [note: 'Order of authors on book cover']
  
  Indexes {
    (book_id, author_id) [pk]
  }
  
  Note: 'Many-to-Many: Books can have multiple authors'
}

Table publishers {
  publisher_id int [pk, increment]
  publisher_name varchar(100) [unique, not null]
  country varchar(50)
  website varchar(255)
}

Table members {
  member_id int [pk, increment]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  email varchar(100) [unique]
  phone varchar(20)
  membership_date date [not null]
  membership_status varchar(20) [default: 'active']
}

Table loans {
  loan_id int [pk, increment]
  book_id int [not null, ref: > books.book_id]
  member_id int [not null, ref: > members.member_id]
  loan_date date [not null]
  due_date date [not null]
  return_date date
  fine_amount decimal(10,2) [default: 0]
  
  Indexes {
    member_id
    book_id
    due_date
  }
  
  Note: 'Track book loans and returns'
}

// ============================================
// UNIVERSITY SYSTEM EXAMPLE
// ============================================

Table students {
  student_id int [pk, increment]
  student_number varchar(20) [unique, not null]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  email varchar(100) [unique]
  enrollment_date date
  major_id int [ref: > majors.major_id]
}

Table courses {
  course_id int [pk, increment]
  course_code varchar(10) [unique, not null]
  course_name varchar(100) [not null]
  credits int
  department_id int [ref: > departments.department_id]
}

Table enrollments {
  enrollment_id int [pk, increment]
  student_id int [not null, ref: > students.student_id]
  course_id int [not null, ref: > courses.course_id]
  semester varchar(20)
  year int
  grade varchar(2)
  
  Indexes {
    (student_id, course_id, semester, year) [unique]
  }
}

Table majors {
  major_id int [pk, increment]
  major_name varchar(100) [unique, not null]
  department_id int [ref: > departments.department_id]
}

Table departments {
  department_id int [pk, increment]
  department_name varchar(100) [unique, not null]
  building varchar(50)
  phone varchar(20)
}

Table instructors {
  instructor_id int [pk, increment]
  first_name varchar(50) [not null]
  last_name varchar(50) [not null]
  email varchar(100) [unique]
  department_id int [ref: > departments.department_id]
  hire_date date
}

Table course_sections {
  section_id int [pk, increment]
  course_id int [not null, ref: > courses.course_id]
  instructor_id int [ref: > instructors.instructor_id]
  semester varchar(20)
  year int
  room varchar(20)
  schedule varchar(100)
  max_students int
  
  Indexes {
    (course_id, semester, year)
  }
}

// ============================================
// RELATIONSHIP TYPES DEMONSTRATION
// ============================================

// One-to-One: Use [ref: -] or ensure unique constraint
Table users {
  user_id int [pk]
  username varchar(50) [unique]
}

Table user_profiles {
  profile_id int [pk]
  user_id int [unique, ref: - users.user_id, note: 'One-to-One']
  bio text
  avatar_url varchar(255)
}

// One-to-Many: Use [ref: >] or [ref: <]
// customers.customer_id < orders.customer_id

// Many-to-Many: Use junction table
// Shown in book_authors and enrollments examples above

// ============================================
// NOTES
// ============================================

/*
DBML Syntax Quick Reference:

Table Definition:
  Table table_name {
    column_name type [attributes]
  }

Column Attributes:
  pk - Primary Key
  increment - Auto-increment
  not null - Cannot be null
  unique - Unique values
  default: value - Default value
  ref: > table.column - Foreign key

Relationships:
  ref: > - Many-to-one
  ref: < - One-to-many
  ref: - - One-to-one

Indexes:
  Indexes {
    column_name
    (col1, col2) [unique]
  }

Use at: https://dbdiagram.io
Or install: npm install -g @dbml/cli
*/
